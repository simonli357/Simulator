<?xml version="1.0" encoding="UTF-8"?>
<launch>
  <!-- Load GPS configuration -->
  <rosparam command="load" file="$(find localization_bridge)/config/gps_config.yaml" />
  <include file="$(find localization_bridge)/launch/bridge.launch"/>

  <!-- Load URDF to parameter server -->
  <param name="robot_description" 
         command="$(find xacro)/xacro '$(find racecar_description)/urdf/racecar.xacro'" />

  <!-- Start robot_state_publisher to broadcast TF frames -->
  <node pkg="robot_state_publisher" type="robot_state_publisher" name="robot_state_publisher" />

  <!-- Launch Gazebo world -->
  <include file="$(find gazebo_ros)/launch/empty_world.launch">
    <arg name="world_name"   value="$(find sim_pkg)/worlds/track_barca.world"/>
    <arg name="paused"       value="false"/>    
    <arg name="use_sim_time" value="true"/>
    <arg name="debug"        value="false"/>
    <arg name="gui"          value="true"/>
  </include>

  <!-- Initial position parameters -->
  <arg name="x_init" default="0"/>
  <arg name="y_init" default="0"/>
  <arg name="z_init" default="0.05"/>  <!-- Matches URDF's base_link2_joint z-offset -->
  <arg name="yaw_init" default="0"/>
  
  <!-- Spawn URDF-based robot -->
  <node name="car1_spawn" 
        pkg="gazebo_ros" 
        type="spawn_model" 
        output="screen" 
        args="-urdf -param robot_description -model car1 
              -x $(arg x_init) -y $(arg y_init) -z $(arg z_init) -Y $(arg yaw_init) -unpause" />
</launch>
